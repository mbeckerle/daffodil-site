
// ///////////////////////////////////////////////////////////////////////////
//
// This file is written in AsciiDoc.
//
// ///////////////////////////////////////////////////////////////////////////
//
// When editing, please start each sentence on a new line.
// See https://asciidoctor.org/docs/asciidoc-recommended-practices/#one-sentence-per-line
// [one sentence-per-line writing technique.]
// This makes textual diffs of this file useful in a similar way to the way they work for code.
//
// //////////////////////////////////////////////////////////////////////////
:page-layout: page
:keywords: DFDL "data format"
= Data Format Description
:hide-uri-scheme:
:toc:
:toclevels: 20
:sectlinks:
:sectanchors:


== Outline/Topic Mind Map

[graphviz,"dataFormat.svg",svg,svg-type=inline]
....
digraph dataFormat1 {
// layout = twopi
// size = "7.5, 7.5"
center=1
overlap=scale
splines=true
root="Data Format"
rankdir=LR
edge [dir=none, fontname="Noto Sans"]
node [fontname="Noto Sans"]


DF [label="Data\nFormat" style=bold shape=doublecircle ]

DF -> Representation
Representation -> Length
DF -> Statements
Statements -> Assertions
Statements -> Variables
DF -> Correctness
Correctness -> WF
WF[label="well-formed"]
Correctness -> Valid -> XSD
XSD[label="XML Schema"]
Valid -> Schematron
XSD -> Facets -> "Pattern Facet" -> "XSD Regex"
DF -> Logical -> Infoset -> Valid
Logical -> Types
Logical -> Dimension
Logical -> Nilled
WF -> Assertions
Representation -> NilRep
Representation -> Empty

subgraph clusterEmpty {
Empty -> Defaulting
Defaulting -> "Use Nil As Default"
Empty -> "Empty Value Delimiter Policy"
Empty -> "Empty Value Parse Policy"
}

subgraph clusterNilRep {
NilRep
NilRep -> "Nil Values"
NilRep -> "Nil Value Delimiter Policy"
NilRep -> "Use Nil As Default"
}

subgraph dimension {
Dimension [ label="Dimension/\nRepetition" ]
}

subgraph length {
label="Length Kinds"
fontname="Noto Sans"
Length -> Explicit, Implicit, Delimited, EndOfParent, Prefixed, Pattern, StopValue
Explicit -> "Fixed Length"
Explicit -> Stored
"Length Units" -> "Bits/Bytes", Chars
Implicit -> "Length Units"
Prefixed -> "Length Units"
Explicit -> "Length Units"
Pattern -> "DFDL Regex"
}

subgraph representation {
Representation ->  Text, Binary, Computed
Computed [label="Computed\n(No Representation)" ]
}
Representation -> POU

subgraph text {
Text
Text -> Lines
Lines [ label="Lines &\nLine Endings" ]
Text -> EncodingSystems

Text -> Padding -> Explicit

Delimited -> Initiators -> Discriminators
Delimited -> Separators -> "Separator Position"
Separators -> "Separator Suppression"
Delimited -> Terminators
Delimited -> "Escape Schemes"

Text -> Fake
}

subgraph clusterEncodingSystems {
EncodingSystems [label="Encoding\nSystems\n(Character Sets)"]
EncodingSystems -> FixedWidth, Variable
EncodingSystems -> EncErrors
EncErrors [ label="Encoding/\nDecoding\nErrors" ]

FixedWidth [ label="Fixed Width" ]
FixedWidth -> SBCS, DBCS
FixedWidth -> LessThan8
LessThan8 [label="Less than 8\nBits Width"]
Variable [ label="Variable\nWidth" ]
Variable -> VCU
VCU [ label="1..N Code Units"]
Variable -> Shifting
VCU -> "Unicode UTF-8"
VCU -> "Unicode UTF-16"
}

subgraph binary {
Binary [URL="#binary-data-formats"]
Binary -> ByteOrder
ByteOrder -> BitOrder
Binary -> BinNumberRep
BinNumberRep [ label="Number\nRepresentation" ]
BinNumberRep -> BinaryNR
BinaryNR[label="Binary\n(Twos Complement)"]
BinNumberRep -> Packed, BCD
Binary -> Alignment
Binary -> Fake
Fake[label="Faking it\nwith\niso-8859-1"]
Fake -> BitsEncoding, HexEncoding, OctalEncoding
BitsEncoding[label="bits"]
HexEncoding[label="hex"]
OctalEncoding[label="octal"]
}

Types->SimpleTypes
Types->ComplexTypes

SimpleTypes[label="Simple\nTypes"]
ComplexTypes[label="Complex\nTypes"]
ComplexTypes -> Sequences
ComplexTypes -> Choices

subgraph clusterSequences {
Sequences -> Ordered
Sequences -> Unordered
}

POU -> Assertions
POU -> Dimension
Assertions -> "Pattern Test" -> Discriminators
Assertions -> "Expression Test" -> Discriminators
"Pattern Test" -> "DFDL Regex"
"Pattern Test" -> Asserts
"Expression Test" -> Asserts
subgraph clusterChoices {
Choices -> Discriminators
Discriminators
Choices -> "By Dispatch"
}

"Pattern Test" -> "DFDL Regex"
"DFDL Regex" -> Lookahead

subgraph clusterSimpleTypes {
SimpleTypes -> Integer, FloatingPoint
SimpleTypes -> FixedPoint
FixedPoint -> Scaled, Decimal
SimpleTypes -> DT
SimpleTypes -> String
SimpleTypes -> Opaque
Opaque [ label="Opaque\nBytes/Bits" ]
DT [label="Dates and Times"
URL="#dates-and-times"]
DT -> DateTime, Date, Time
}

}
....

== Binary Data Formats

NOTE: TBD: Section on binary data formats.

== Types

=== Dates and Times

For some reason in DFDL all the properties associate with dates and times contain the word calendar.

NOTE: This seems to be a legacy DFDL inherited from the Java programming language where the initial date/time-related library of classes were named using those terms, but these initial libraries were deemed insufficient.
The next re-invention of these libraries didn't want to be confused with the earlier one, despite sharing many concepts, so the term "calendar" is used to distinguish them.

== Textual Data Formats

Intuitively, _text_ is what we call data representations that use the characters of natural language alphabets, scripts, and numeric digits that are used by people for writing.

==== Text Terminology

- character
- lines
-- line endings
- charset, encoding, character set
-- ASCII, ISO-8859-1, UTF-8, EBCDIC
- code unit, width
- code point
- encode, decode
- Unicode
- glyph
- whitespace
-- space, tab, LF, CR
- control characters
-- CC0, CC1
- SBCS, DBCS


[graphviz,"dataFormat2.svg",svg,svg-type=inline]
....
digraph dataFormat2 {

// size = "7.5,10"
center=1
overlap=scale
splines=false
root="Advanced"
rankdir=LR
edge [dir=none]
node [fontname="Noto Sans"]


A [label="Advanced" style=bold shape=doublecircle ]

"Canonical Forms" -> "Round Trip"
A -> UC


subgraph UseCases {
UC [ label="Use Cases" ]
UC -> "Data\nIntegration"
UC -> "Data\nDirected\nRouting"
UC -> "Cybersecurity"

"Cybersecurity" -> "Covert Channels" -> "Canonical Forms"
}

A -> ParserTopics
ParserTopics -> StreamingOrNot
ParserTopics -> ErrorRecovery
ErrorRecovery -> VariablesWhenToUseThem
A -> UnparserTopics
UnparserTopics -> StreamingOrNot

XSD -> NoRealArrays
XSD -> RootElements
XSD -> Namespaces -> Prefixes, TargetNS, DefaultNS
XSD -> SchemaLocation -> Resolver -> JarFiles -> AutomatedDependencyManagement -> SBT, Maven

A -> layers -> StreamingOrNot

A -> BLOBs

A-> "Parsing Syntax As Data"

A -> TDML
}
....
